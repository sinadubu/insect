<!DOCTYPE html>
<html class="dark" lang="ko">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>AI 곤충 행동 분석 - 업로드</title>

    <!-- 외부 리소스 로드: Tailwind CSS, 폰트, 아이콘 -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />

    <script id="tailwind-config">
        // Tailwind CSS 설정: 다크모드 및 색상 테마 정의
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#13b6ec",
                        "background-light": "#f6f8f8",
                        "background-dark": "#101d22",
                        "card-dark": "#111827",
                    },
                    fontFamily: {
                        display: ["Space Grotesk", "Noto Sans KR", "sans-serif"],
                    },
                },
            },
        }
    </script>

    <style>
        /* 아이콘 스타일 설정 */
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        /* 채워진 아이콘 스타일 */
        .icon-filled {
            font-variation-settings: 'FILL' 1;
        }

        /* 전체 높이 설정 */
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display">
    <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
        <!-- 상단 헤더: 로고 및 사용자 메뉴 -->
        <header
            class="sticky top-0 z-10 flex items-center justify-between border-b border-white/10 bg-background-light/80 p-4 backdrop-blur-sm dark:bg-background-dark/80">
            <h1
                class="flex-1 font-display text-xl font-bold leading-tight tracking-[-0.015em] text-slate-800 dark:text-white">
                AI 곤충 행동 분석
            </h1>

            <!-- 사용자 인증 상태에 따른 버튼 표시 -->
            {% if current_user %}
            <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
                <!-- 사용자 이름 및 등급 표시 -->
                <span class="hidden md:inline">
                    {{ current_user.name }} 님
                    {% if current_user.role == "admin" %}
                    <span class="ml-1 rounded-full bg-primary/10 px-2 py-0.5 text-[10px] text-primary font-bold">
                        ADMIN
                    </span>
                    {% endif %}
                </span>
                <!-- 대시보드 및 로그아웃 버튼 -->
                <a href="/dashboard"
                    class="inline-flex items-center gap-1 rounded-full border border-slate-300/70 px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
                    <span class="material-symbols-outlined text-sm">dashboard</span>
                    대시보드
                </a>
                <a href="{{ url_for('logout') }}"
                    class="inline-flex items-center gap-1 rounded-full border border-slate-300/70 px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
                    <span class="material-symbols-outlined text-sm">logout</span>
                    로그아웃
                </a>
            </div>
            {% else %}
            <!-- 비로그인 사용자용 메뉴 -->
            <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
                <a href="{{ url_for('login') }}"
                    class="inline-flex items-center gap-1 rounded-full border border-slate-300/70 px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
                    <span class="material-symbols-outlined text-sm">login</span>
                    로그인
                </a>
                <a href="{{ url_for('register') }}"
                    class="inline-flex items-center gap-1 rounded-full bg-primary px-3 py-1 text-xs font-medium text-white hover:bg-primary/90">
                    회원가입
                </a>
            </div>
            {% endif %}
        </header>

        <!-- 메인 콘텐츠 영역 -->
        <main class="flex-1 w-full max-w-3xl mx-auto p-4 pb-24 space-y-6">
            <!-- 설명 섹션 -->
            <section class="space-y-2">
                <h2 class="text-lg font-bold text-slate-900 dark:text-white">
                    사육장 영상 업로드
                </h2>
                <p class="text-xs text-slate-500 dark:text-slate-400">
                    사육장 번호와 함께 영상을 업로드하면 자동으로
                    <span class="font-semibold">키프레임 추출 → 객체 검출 → 이상/정상 분류</span>가 수행됩니다.
                </p>
            </section>

            <!-- 업로드 카드 섹션 -->
            <section
                class="rounded-xl bg-white/90 p-6 shadow-sm ring-1 ring-slate-200/60 dark:bg-card-dark/95 dark:ring-slate-800">
                <form id="uploadForm" class="space-y-5">
                    <!-- 사육장 ID 입력 -->
                    <div class="space-y-1">
                        <label for="farmId" class="block text-xs font-medium text-slate-700 dark:text-slate-200">
                            사육장 ID
                        </label>
                        <input id="farmId" name="farm_id" type="text" required
                            class="mt-1 w-full rounded-lg border border-slate-300 bg-white/80 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/40 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100"
                            placeholder="예) FARM-001" />
                    </div>

                    <!-- 드래그&드롭 및 파일 선택 영역 -->
                    <div id="dropZone"
                        class="mt-2 flex flex-col items-center justify-center gap-3 rounded-xl border border-dashed border-slate-300 bg-slate-50/80 px-4 py-8 text-center text-xs text-slate-500 transition hover:border-primary hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-300">
                        <span class="material-symbols-outlined text-3xl text-slate-400 dark:text-slate-500">
                            movie
                        </span>
                        <p class="max-w-xs">
                            여기로 영상을 드래그해서 업로드하거나,
                            <span class="font-semibold text-primary">파일 선택</span> 버튼을 눌러주세요.
                        </p>
                        <button type="button" id="selectFileBtn"
                            class="mt-1 inline-flex items-center gap-1 rounded-full bg-primary px-4 py-1.5 text-xs font-semibold text-white hover:bg-primary/90">
                            <span class="material-symbols-outlined text-sm">upload</span>
                            파일 선택
                        </button>
                        <input id="videoFile" name="video" type="file" accept="video/*" class="hidden" />
                        <p id="selectedFileName" class="mt-2 text-[11px] text-slate-500 dark:text-slate-400">
                            선택된 파일이 없습니다.
                        </p>
                    </div>

                    <!-- 업로드 버튼 및 상태 메시지 -->
                    <div class="flex items-center justify-between gap-3 pt-2">
                        <p id="uploadMessage" class="text-[11px] text-slate-500 dark:text-slate-400">
                            업로드 후 대기하면, 자동으로 분석이 시작됩니다.
                        </p>
                        <button type="submit"
                            class="inline-flex items-center gap-1 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-white hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="material-symbols-outlined text-sm">play_arrow</span>
                            업로드 및 분석 시작
                        </button>
                    </div>
                </form>
            </section>
        </main>

        <!-- 하단 네비게이션 바 (모바일 친화적) -->
        <div
            class="fixed bottom-0 left-0 right-0 h-20 bg-white/80 dark:bg-background-dark/90 backdrop-blur-lg border-t border-black/10 dark:border-white/10 z-50">
            <div class="flex justify-around items-center h-full max-w-screen-xl mx-auto">
                <!-- 대시보드 이동 -->
                <a class="flex flex-col items-center gap-1 text-black/60 dark:text-white/60 hover:text-primary"
                    href="/dashboard">
                    <span class="material-symbols-outlined">dashboard</span>
                    <span class="text-xs font-medium">대시보드</span>
                </a>
                <!-- 현재 페이지: 업로드 -->
                <a class="flex flex-col items-center gap-1 text-primary" href="/upload">
                    <span class="material-symbols-outlined icon-filled">upload</span>
                    <span class="text-xs font-bold">업로드</span>
                </a>
            </div>
        </div>
    </div>

    <!-- 업로드 로직 처리 스크립트 -->
    <script src="{{ url_for('static', filename='js/upload.js') }}"></script>
</body>

</html>