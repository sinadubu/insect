<!DOCTYPE html>
<html class="dark" lang="ko">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>AI 분석 상세 결과</title>

  <!-- 외부 리소스 로드: Tailwind CSS, 폰트, 아이콘 -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    rel="stylesheet" />

  <script>
    // Tailwind CSS 설정: 다크모드 및 색상 테마 정의
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#13b6ec",
            "background-light": "#f6f8f8",
            "background-dark": "#101d22",
            "card-dark": "#111827",
          },
          fontFamily: {
            display: ["Space Grotesk", "Noto Sans KR", "sans-serif"],
          },
        },
      },
    }
  </script>

  <style>
    /* 아이콘 스타일 설정 */
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    /* 채워진 아이콘 스타일 */
    .icon-filled {
      font-variation-settings: 'FILL' 1;
    }

    /* 최소 높이 설정: 모바일 브라우저 호환성 고려 */
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display" data-video-id="{{ video_id }}">
  <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
    <!-- 상단 헤더: 제목 및 네비게이션 -->
    <header
      class="flex items-center bg-background-light/80 dark:bg-background-dark/80 sticky top-0 z-10 p-4 justify-between border-b border-white/10">
      <div class="flex items-center gap-3 flex-1">
        <h1 class="text-slate-800 dark:text-white text-xl font-bold leading-tight tracking-[-0.015em] font-display">
          분석 결과 상세
        </h1>
        <!-- 목록으로 돌아가기 버튼 -->
        <button id="back-button"
          class="flex items-center gap-2 text-primary text-sm font-bold leading-normal tracking-[0.015em] shrink-0">
          <span class="material-symbols-outlined text-lg">arrow_back</span>
          목록으로 돌아가기
        </button>
      </div>

      <!-- 사용자 인증 상태에 따른 메뉴 표시 -->
      {% if current_user %}
      <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
        <!-- 사용자 이름 및 관리자 배지 -->
        <span class="hidden md:inline">
          {{ current_user.name }} 님
          {% if current_user.role == "admin" %}
          <span class="ml-1 rounded-full bg-primary/10 px-2 py-0.5 text-[10px] text-primary font-bold">
            ADMIN
          </span>
          {% endif %}
        </span>
        <!-- 대시보드 이동 버튼 -->
        <a href="/dashboard"
          class="inline-flex items-center gap-1 rounded-full border border-slate-300/70 px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
          <span class="material-symbols-outlined text-sm">dashboard</span>
          대시보드
        </a>
        <!-- 로그아웃 버튼 -->
        <a href="{{ url_for('logout') }}"
          class="inline-flex items-center gap-1 rounded-full border border-slate-300/70 px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
          <span class="material-symbols-outlined text-sm">logout</span>
          로그아웃
        </a>
      </div>
      {% else %}
      <!-- 비로그인 사용자용 메뉴 -->
      <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
        <a href="{{ url_for('login') }}"
          class="inline-flex items-center gap-1 rounded-full border border-slate-300/70 px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
          <span class="material-symbols-outlined text-sm">login</span>
          로그인
        </a>
        <a href="{{ url_for('register') }}"
          class="inline-flex items-center gap-1 rounded-full bg-primary px-3 py-1 text-xs font-medium text-white hover:bg-primary/90">
          회원가입
        </a>
      </div>
      {% endif %}
    </header>

    <!-- 메인 콘텐츠: 영상 정보 및 분석 결과 -->
    <main class="flex-1 w-full max-w-5xl mx-auto p-4 pb-28 space-y-8">
      <!-- 분석 대상 영상 요약 정보 섹션 -->
      <section
        class="rounded-xl bg-white/80 p-6 shadow-sm ring-1 ring-slate-200/60 dark:bg-slate-900/80 dark:ring-slate-800">
        <h2 class="text-lg font-bold text-slate-900 dark:text-white mb-4">
          분석 대상 영상
        </h2>

        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div class="space-y-1">
            <!-- 영상 파일명 (JS로 로드됨) -->
            <p id="video-filename" class="text-base font-semibold text-slate-900 dark:text-slate-50 break-all">
              (로딩 중...)
            </p>
            <!-- 사육장 ID -->
            <p class="text-xs text-slate-500 dark:text-slate-400">
              사육장 ID :
              <span id="farm-id" class="font-medium text-slate-800 dark:text-slate-200">
                -
              </span>
            </p>
            <!-- 영상 길이 -->
            <p class="text-xs text-slate-500 dark:text-slate-400">
              영상 길이 :
              <span id="video-duration" class="font-medium text-slate-800 dark:text-slate-200">
                -
              </span>
            </p>
            <!-- 업로드 시각 -->
            <p class="text-xs text-slate-500 dark:text-slate-400">
              업로드 시각 :
              <span id="video-created-at" class="font-medium text-slate-800 dark:text-slate-200">
                -
              </span>
            </p>
          </div>

          <!-- 상태 표시 배지 -->
          <div class="flex flex-col items-end gap-2">
            <span id="video-status-badge"
              class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600 dark:bg-slate-800/70 dark:text-slate-200">
              <span class="material-symbols-outlined text-sm">hourglass_top</span>
              상태 확인 중
            </span>
            <p id="video-status-text" class="text-xs text-slate-500 dark:text-slate-400 text-right">
              분석 상태를 불러오는 중입니다...
            </p>
          </div>
        </div>
      </section>

      <!-- 키프레임 분석 결과 목록 섹션 -->
      <section
        class="rounded-xl bg-white/80 p-6 shadow-sm ring-1 ring-slate-200/60 dark:bg-slate-900/80 dark:ring-slate-800">
        <div class="flex items-center justify-between gap-2">
          <h2 class="text-lg font-bold text-slate-900 dark:text-white">
            키프레임 분석 결과
          </h2>
        </div>
        <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
          각 시점별로 검출된 객체와
          <span class="font-semibold">정상 / 비정상 판정</span> 결과를 확인할 수 있습니다.
        </p>

        <!-- 키프레임 목록 컨테이너 (JS로 동적 생성) -->
        <div id="keyframes-container" class="mt-5 space-y-3">
          <div
            class="rounded-xl bg-slate-100 p-6 text-center text-sm text-slate-500 dark:bg-slate-800/50 dark:text-slate-300">
            키프레임 데이터를 불러오는 중입니다...
          </div>
        </div>
      </section>
    </main>

    <!-- 하단 고정 바: 분석 삭제 버튼 -->
    <footer
      class="fixed bottom-0 left-0 right-0 border-t border-slate-200/70 bg-white/80 px-4 py-3 backdrop-blur-sm dark:border-slate-700/80 dark:bg-slate-900/90">
      <div class="mx-auto flex max-w-5xl items-center justify-between gap-3">
        <p class="text-[11px] text-slate-500 dark:text-slate-400">
          이 분석 결과는 대시보드와 업로드 목록에서도 다시 확인할 수 있습니다.
        </p>
        <button id="delete-button"
          class="flex h-9 shrink-0 items-center justify-center gap-1 rounded-full bg-red-500 px-4 text-xs font-semibold text-white hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700">
          <span class="material-symbols-outlined text-sm">delete</span>
          <span>분석 삭제</span>
        </button>
      </div>
    </footer>
  </div>

  <!-- 분석 로직 처리를 위한 외부 JS 파일 로드 -->
  <script src="{{ url_for('static', filename='js/analysis.js') }}"></script>
</body>

</html>