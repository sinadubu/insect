# 곤충 자동 사육 비전 AI 프로젝트 사용 매뉴얼

안녕하세요! 이 문서는 갈색거저리 유충(밀웜) 모니터링 시스템을 원활하게 사용하실 수 있도록 안내하는 매뉴얼입니다.
시스템 설치부터 실행, 그리고 각 기능별 사용 방법까지 차근차근 설명해 드릴게요.

## 1. 프로젝트 개요

이 시스템은 사육장에서 촬영한 동영상을 분석하여 유충의 생육 상태를 자동으로 모니터링합니다.

주요 처리 과정:
1. 키프레임 추출: 영상에서 분석에 필요한 장면을 자동으로 선별합니다.
2. 객체 탐지 (YOLO): 화면 내의 유충 위치를 찾아냅니다.
3. 상태 분류 (ResNet-50): 탐지된 유충이 정상인지 비정상(폐사, 질병 등)인지 판단합니다.
4. 시각화: 웹 대시보드를 통해 분석 결과를 한눈에 확인할 수 있습니다.

## 2. 실행 환경

원활한 실행을 위해 다음 환경을 권장합니다.

- OS: Windows 10/11 또는 Ubuntu 20.04 이상
- Python: 3.8 버전 이상
- 필수 프로그램:
  - Git
  - MongoDB (또는 Docker 환경)
- 권장 사항:
  - NVIDIA GPU + CUDA (AI 모델 분석 속도 향상을 위해 권장됩니다)

## 3. 설치 방법

### 3.1 프로젝트 내려받기

먼저 Git을 사용하여 소스 코드를 다운로드합니다.

```bash
git clone https://github.com/sinadubu/insect.git
cd insect
```

### 3.2 가상환경 설정 및 패키지 설치

파이썬 가상환경을 만들고 필요한 라이브러리를 설치해 주세요.

```bash
# 가상환경 생성 (Windows 예시)
python -m venv venv

# 가상환경 활성화
. env\Scripts\activate

# 의존성 패키지 설치
pip install -r requirements.txt
```

## 4. 데이터베이스 및 환경 설정

### 4.1 MongoDB 설정

이 프로젝트는 영상 정보와 분석 결과를 저장하기 위해 MongoDB를 사용합니다.

- 로컬 설치 시: MongoDB Community Edition을 설치하고 실행합니다 (기본 포트 27017).
- Docker 사용 시: 아래 명령어로 컨테이너를 실행할 수 있습니다.

```bash
docker run -d --name insect-mongo -p 27017:27017 -e MONGO_INITDB_ROOT_USERNAME=root -e MONGO_INITDB_ROOT_PASSWORD=example mongo
```

### 4.2 환경 변수 파일 (.env) 생성

프로젝트 루트 폴더(project-root)에 .env 파일을 만들고 아래 내용을 입력해 주세요.

```env
FLASK_ENV=development
MONGO_URI=mongodb://localhost:27017
MONGO_DB_NAME=insect_db
UPLOAD_FOLDER=static/uploads
DEVICE=cpu  # GPU 사용 가능 시 'cuda'로 변경
```

## 5. AI 모델 가중치 파일 준비

용량 문제로 GitHub에 포함되지 않은 모델 파일들은 별도로 다운로드하여 프로젝트 루트 폴더에 넣어주셔야 합니다.

- YOLO 모델: yolo.pt
- ResNet 분류기: best_resnet50_mealworm.pth

파일 배치가 완료되면 ai/pipeline.py 등에서 문제없이 모델을 불러올 수 있습니다.

## 6. 서버 실행 및 접속

모든 준비가 끝났다면 이제 웹 서버를 실행해 봅시다.

### 6.1 직접 실행하기 (Python)

```bash
python app.py
```

### 6.2 Docker Compose로 실행하기 (선택)

Docker가 설치되어 있다면 더 간편하게 실행할 수 있습니다.

```bash
docker compose up --build
```

서버가 켜졌다면 브라우저를 열고 다음 주소로 접속하세요.
http://localhost:5000

## 7. 웹 서비스 사용 가이드

### 7.1 동영상 업로드 (/upload)

1. 사육장 ID 입력: 관리할 사육장 번호를 입력합니다 (예: A-01).
2. 영상 선택: 분석할 동영상 파일을 선택하거나 드래그하여 놓습니다.
3. 업로드: 버튼을 누르면 서버로 전송되며, 백그라운드에서 AI 분석이 시작됩니다.

### 7.2 대시보드 (/dashboard)

- 전체 영상의 분석 진행 상황(대기 중, 분석 중, 완료 등)을 실시간으로 확인할 수 있습니다.
- 분석이 완료된 항목은 '정상' 또는 '비정상' 여부가 표시됩니다.

### 7.3 상세 분석 결과 (/analysis/<video_id>)

- 요약 정보: 전체 개체 수와 비정상 개체 비율을 통계로 보여줍니다.
- 키프레임 뷰어: 비정상 개체가 발견된 시점의 이미지를 확인하고, 박스로 표시된 위치를 볼 수 있습니다.
- 개체 이미지: 각각의 유충 이미지를 자세히 살펴볼 수 있습니다.

### 7.4 관리자 페이지 (/admin/users)

- 등록된 사용자 목록을 관리하거나, 불필요한 데이터를 정리할 수 있습니다.

## 8. 문제 해결 (FAQ)

Q. 'MongoDB 연결 실패' 오류가 뜹니다.
> .env 파일의 MONGO_URI 주소가 맞는지, 그리고 MongoDB 서버가 켜져 있는지 확인해 주세요.

Q. 분석이 너무 오래 걸립니다.
> CPU 모드로 실행 중일 수 있습니다. GPU가 있다면 .env에서 DEVICE=cuda로 설정하고, CUDA 환경이 제대로 잡혀있는지 확인해 보세요.

Q. 모델 파일을 찾을 수 없다고 나와요.
> yolo.pt와 best_resnet50_mealworm.pth 파일이 app.py와 같은 위치(프로젝트 루트)에 있는지 다시 한번 확인해 주세요.

## 9. 문의 및 피드백

사용 중 궁금한 점이나 개선 제안은 언제든지 환영합니다.

- 개발자: 이도훈
- GitHub: https://github.com/sinadubu

감사합니다!
